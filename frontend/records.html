<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Records - DHRMS Kerala</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <header class="header">
    <div class="logo-container">
       <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="white" class="me-2">
        <path d="M12,2A10,10,0,0,0,2,12A10,10,0,0,0,12,22A10,10,0,0,0,22,12A10,10,0,0,0,12,2M7.07,18.28L7.07,18.28L8,17.35L11,20.35L11,15.5A1,1,0,0,1,12,14.5A1,1,0,0,1,13,15.5L13,20.35L16,17.35L16.93,18.28L12,23.21L7.07,18.28M12,0.79L16.93,5.72L16,6.65L13,3.65L13,8.5A1,1,0,0,1,12,9.5A1,1,0,0,1,11,8.5L11,3.65L8,6.65L7.07,5.72L12,0.79Z" />
      </svg>
      <h1 class="app-title">DHRMS Kerala</h1>
    </div>
    <nav class="navbar">
      <a href="index.html">Dashboard</a>
      <a href="records.html" class="active">My Records</a>
      <a href="appointments.html">Appointments</a>
      <a href="resources.html">Health Resources</a>
      <a href="clinics.html">Clinics</a>
    </nav>
  </header>

  <main class="page-content">
    <div class="page-container" id="records-container">
      <!-- Dynamic content will be injected here -->
      <h2 class="display-6 fw-bold">Loading records...</h2>
    </div>
  </main>

  <footer class="footer">
    <p>Â© 2025 DHRMS Kerala. All Rights Reserved.</p>
  </footer>

  <script src="localstorage-manager.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loggedInUserAadhaar = sessionStorage.getItem('loggedInUser');
      const recordsContainer = document.getElementById('records-container');

      if (!loggedInUserAadhaar) {
        recordsContainer.innerHTML = '<h2 class="display-6 fw-bold">You are not logged in.</h2><p><a href="index.html">Please log in to view your records.</a></p>';
        return;
      }

      const allPatients = getPatientData();
      const patient = allPatients.find(p => p.aadhaar === loggedInUserAadhaar);

      if (!patient) {
        recordsContainer.innerHTML = '<h2>Error: Could not find your patient record.</h2>';
        return;
      }

      let surveyHtml = `
        <div class="alert alert-warning">
          <strong>No Survey Data Found:</strong> You have not submitted a medical survey yet. <a href="survey.html" class="alert-link">Click here to complete it.</a>
        </div>`;

      if (patient.survey) {
        surveyHtml = `
          <div class="record-section">
            <h4 class="record-title">Latest Medical Survey</h4>
            <p><strong>Date Submitted:</strong> ${new Date(patient.survey.dateSubmitted).toLocaleString()}</p>
            <p><strong>State of Origin:</strong> ${patient.survey.stateOrigin}</p>
            <p><strong>District of Origin:</strong> ${patient.survey.districtOrigin}</p>
            <p><strong>Current Location:</strong> ${patient.survey.currentLocation || 'Not provided'}</p>
            <p><strong>Reported Symptoms:</strong></p>
            <pre>${patient.survey.symptoms || 'None'}</pre>
          </div>
        `;
      }
      
      recordsContainer.innerHTML = `
        <h2 class="display-6 fw-bold mb-4">Medical Records for ${patient.name}</h2>
        <div class="record-section">
            <h4 class="record-title">Personal Information</h4>
            <p><strong>Full Name:</strong> ${patient.name}</p>
            <p><strong>Aadhaar Number:</strong> ${patient.aadhaar}</p>
            <p><strong>Account Registered On:</strong> ${new Date(patient.registrationDate).toLocaleDateString()}</p>
        </div>
        ${surveyHtml}
      `;
    });
  </script>
</body>
</html>

