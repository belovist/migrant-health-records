<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DHRMS Kerala - Welcome</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <header class="header">
    <div class="logo-container">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="white" class="me-2">
        <path d="M12,2A10,10,0,0,0,2,12A10,10,0,0,0,12,22A10,10,0,0,0,22,12A10,10,0,0,0,12,2M7.07,18.28L7.07,18.28L8,17.35L11,20.35L11,15.5A1,1,0,0,1,12,14.5A1,1,0,0,1,13,15.5L13,20.35L16,17.35L16.93,18.28L12,23.21L7.07,18.28M12,0.79L16.93,5.72L16,6.65L13,3.65L13,8.5A1,1,0,0,1,12,9.5A1,1,0,0,1,11,8.5L11,3.65L8,6.65L7.07,5.72L12,0.79Z" />
      </svg>
      <h1 class="app-title">DHRMS Kerala</h1>
    </div>
    <nav class="navbar" id="main-navbar" style="display: none;">
      <a href="#" id="dashboard-link" class="active">Dashboard</a>
      <a href="records.html">My Records</a>
      <a href="appointments.html">Appointments</a>
      <a href="resources.html">Health Resources</a>
      <a href="clinics.html">Clinics</a>
    </nav>
  </header>

  <main class="page-content">
    <div id="role-selection-wrapper">
      <div class="login-container">
        <div class="login-hero-section">
          <div class="login-hero-content">
            <h1 class="display-5 fw-bold text-white mb-3">Digital Health Management</h1>
            <p class="lead text-white-75 mb-4">Your health records, accessible and secure.</p>
          </div>
        </div>
        <div class="login-form-section">
          <h2 class="fw-bold mb-4">Select Your Role</h2>
          <div class="row g-3">
            <div class="col-12">
              <div class="role-card" id="patient-card">
                <div class="role-card-body">
                  <h3 class="role-card-title">Patient</h3>
                  <p class="role-card-text">Access your health records and appointments.</p>
                </div>
                <form id="patient-form" class="role-form d-none p-4">
                  <div class="mb-3 text-start">
                    <label for="patient-id" class="form-label">Aadhaar Number</label>
                    <input type="text" class="form-control" id="patient-id" placeholder="1234-5678-9012" required>
                  </div>
                  <div class="mb-3 text-start">
                    <label for="patient-password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="patient-password" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Login as Patient</button>
                </form>
              </div>
            </div>
             <div class="col-12">
              <div class="role-card" id="admin-card">
                <div class="role-card-body">
                  <h3 class="role-card-title">Admin</h3>
                  <p class="role-card-text">Manage data and monitor trends.</p>
                </div>
                <form id="admin-form" class="role-form d-none p-4">
                  <div class="mb-3 text-start">
                    <label for="admin-id" class="form-label">Employee ID</label>
                    <input type="text" class="form-control" id="admin-id" placeholder="EMP12345" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Login as Admin</button>
                </form>
              </div>
            </div>
          </div>
          <p class="mt-4 text-center text-muted">Don't have an account? <a href="signup.html" class="fw-bold text-decoration-none">Sign Up</a></p>
        </div>
      </div>
    </div>
    
    <div id="dashboard-content-wrapper" style="display: none;"></div>
  </main>

  <footer class="footer">
    <p>Â© 2025 DHRMS Kerala. All Rights Reserved.</p>
  </footer>

  <script src="localstorage-manager.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const roleSelectionWrapper = document.getElementById('role-selection-wrapper');
      const patientCard = document.getElementById('patient-card');
      const adminCard = document.getElementById('admin-card');
      const patientForm = document.getElementById('patient-form');
      const adminForm = document.getElementById('admin-form');
      const patientIdInput = document.getElementById('patient-id');
      const dashboardWrapper = document.getElementById('dashboard-content-wrapper');

      const loggedInUserAadhaar = sessionStorage.getItem('loggedInUser');
      if (loggedInUserAadhaar) {
        const patient = getPatientData().find(p => p.aadhaar === loggedInUserAadhaar);
        if (patient) {
          roleSelectionWrapper.style.display = 'none';
          renderDashboard(patient);
        }
      }
      
      document.getElementById('dashboard-link').addEventListener('click', (e) => {
        e.preventDefault();
        window.location.reload();
      });

      patientIdInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 4) value = value.slice(0, 4) + '-' + value.slice(4);
        if (value.length > 9) value = value.slice(0, 9) + '-' + value.slice(9, 13);
        e.target.value = value;
      });
      
      const cards = [patientCard, adminCard];
      const selectRole = (selectedCard) => {
        cards.forEach(card => {
          const form = card.querySelector('.role-form');
          if (card === selectedCard) {
            card.classList.add('selected');
            form.classList.remove('d-none');
          } else {
            card.classList.remove('selected');
            form.classList.add('d-none');
          }
        });
      };

      patientCard.addEventListener('click', () => selectRole(patientCard));
      adminCard.addEventListener('click', () => selectRole(adminCard));

      patientForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const userId = patientIdInput.value.trim();
        const password = document.getElementById('patient-password').value;
        const patient = authenticatePatient(userId, password);

        if (!patient) {
          alert('Invalid Aadhaar number or password.');
          return;
        }
        
        sessionStorage.setItem('loggedInUser', patient.aadhaar);
        roleSelectionWrapper.style.display = 'none';
        renderDashboard(patient);
      });

      adminForm.addEventListener('submit', (event) => {
          event.preventDefault();
          const adminId = document.getElementById('admin-id').value;
          // In a real app, you'd validate this. For now, we just redirect.
          if (adminId) {
              window.location.href = 'admin.html';
          } else {
              alert('Please enter an Employee ID.');
          }
      });

      function renderDashboard(patient) {
        document.getElementById('main-navbar').style.display = 'flex';
        dashboardWrapper.style.display = 'block';
        
        dashboardWrapper.innerHTML = `
          <div class="patient-dashboard-grid">
            <div class="dashboard-card hero-card">
              <h2 class="hero-title">Welcome, ${patient.name.split(' ')[0]}!</h2>
              <p class="health-id">Aadhaar: <strong>${patient.aadhaar}</strong></p>
            </div>
            <div class="dashboard-card quick-access-card" onclick="location.href='records.html';">
              <p>My Records</p>
            </div>
            <div class="dashboard-card quick-access-card" onclick="location.href='appointments.html';">
              <p>Appointments</p>
            </div>
            <div class="dashboard-card quick-access-card" onclick="location.href='resources.html';">
              <p>Health Resources</p>
            </div>
             <div class="dashboard-card quick-access-card" onclick="location.href='clinics.html';">
              <p>Find Nearest Clinic</p>
            </div>
          </div>
          <div class="survey-prompt-container">
            <button class="btn btn-primary btn-lg survey-btn" onclick="location.href='survey.html'">Take Medical Survey</button>
          </div>
        `;
      }
    });
  </script>
</body>
</html>

